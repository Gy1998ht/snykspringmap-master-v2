(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-37886384"],{5892:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"a",(function(){return n}));a("d3b7"),a("159b");var i=a("852e");function r(e){var t="",a=[],r=[],n=new i.Parser({onopentag:function(e,i){switch(e){case"node":a.push({id:i["id"]});break;case"edge":r.push({id:i["id"],source:i["source"],target:i["target"]});break;case"data":"key"in i&&(t=i["key"]);break}},ontext:function(e){switch(t){case"node_label":a[a.length-1]["type"]=e;break;case"node_name":a[a.length-1]["label"]=e;break;case"edge_relation":r[r.length-1]["label"]=e;break;case"node_tag":"tags"in a[a.length-1]?a[a.length-1].tags.push(e):a[a.length-1].tags=[e];break;case"node_risk":"risks"in a[a.length-1]?a[a.length-1].risks.push(e):a[a.length-1].risks=[e];break;case"node_serviceId":a[a.length-1]["serviceId"]=e;break;case"node_serviceNodeId":a[a.length-1]["serviceNodeId"]=e;break;case"node_riskId":a[a.length-1]["riskId"]=e;break;case"node_riskNodeId":a[a.length-1]["riskNodeId"]=e;break;case"node_version":a[a.length-1]["version"]=e;break}t=""},onclosetag:function(e){}});return n.write(e),n.end(),{nodes:a,links:r}}function n(e){var t=document.implementation.createDocument("","",null),a=t.createElement("GraphXML");t.appendChild(a);var i=t.createElement("key");i.setAttribute("id","node_name"),i.setAttribute("for","node"),i.setAttribute("attr.name","name"),i.setAttribute("attr.type","string"),a.appendChild(i);var r=t.createElement("key");r.setAttribute("id","node_label"),r.setAttribute("for","node"),r.setAttribute("attr.name","label"),r.setAttribute("attr.type","string"),a.appendChild(r);var n=t.createElement("key");n.setAttribute("id","node_risk"),n.setAttribute("for","node"),n.setAttribute("attr.name","risk"),n.setAttribute("attr.type","string"),a.appendChild(n);r=t.createElement("key");r.setAttribute("id","node_serviceId"),r.setAttribute("for","node"),r.setAttribute("attr.name","serviceId"),r.setAttribute("attr.type","int"),a.appendChild(r);r=t.createElement("key");r.setAttribute("id","node_riskId"),r.setAttribute("for","node"),r.setAttribute("attr.name","riskId"),r.setAttribute("attr.type","int"),a.appendChild(r);r=t.createElement("key");r.setAttribute("id","node_serviceNodeId"),r.setAttribute("for","node"),r.setAttribute("attr.name","serviceNodeId"),r.setAttribute("attr.type","int"),a.appendChild(r);r=t.createElement("key");r.setAttribute("id","node_riskNodeId"),r.setAttribute("for","node"),r.setAttribute("attr.name","riskNodeId"),r.setAttribute("attr.type","int"),a.appendChild(r);r=t.createElement("key");r.setAttribute("id","node_version"),r.setAttribute("for","node"),r.setAttribute("attr.name","version"),r.setAttribute("attr.type","string"),a.appendChild(r);var s=t.createElement("key");s.setAttribute("id","edge_relation"),s.setAttribute("for","edge"),s.setAttribute("attr.name","relation"),s.setAttribute("attr.type","string"),a.appendChild(s);var o=t.createElement("graph");return s.setAttribute("id","g1"),s.setAttribute("edgedefault","directed"),a.appendChild(o),e.nodes.forEach((function(e){var a=t.createElement("node");a.setAttribute("id",e.id),o.appendChild(a);var i=t.createElement("data");i.setAttribute("key","node_name"),i.innerHTML=e.label,a.appendChild(i);var r=t.createElement("data");if(r.setAttribute("key","node_label"),r.innerHTML=e.type,a.appendChild(r),void 0!=e.serviceId){var n=t.createElement("data");n.setAttribute("key","node_serviceId"),n.innerHTML=e.serviceId,a.appendChild(n)}if(void 0!=e.riskId){var s=t.createElement("data");s.setAttribute("key","node_riskId"),s.innerHTML=e.riskId,a.appendChild(s)}if(void 0!=e.serviceNodeId){var l=t.createElement("data");l.setAttribute("key","node_serviceNodeId"),l.innerHTML=e.serviceNodeId,a.appendChild(l)}if(void 0!=e.riskNodeId){var d=t.createElement("data");d.setAttribute("key","node_riskNodeId"),d.innerHTML=e.riskNodeId,a.appendChild(d)}if(void 0!=e.version){var c=t.createElement("data");c.setAttribute("key","node_version"),c.innerHTML=e.version,a.appendChild(c)}void 0!=e.tags&&e.tags.forEach((function(e){var i=t.createElement("data");i.setAttribute("key","node_tag"),i.innerHTML=e,a.appendChild(i)})),void 0!=e.risks&&e.risks.forEach((function(e){var i=t.createElement("data");i.setAttribute("key","node_risk"),i.innerHTML=e,a.appendChild(i)}))})),e.links.forEach((function(e){var a=t.createElement("edge");a.setAttribute("id",e.id),a.setAttribute("source",e.source),a.setAttribute("target",e.target),o.appendChild(a);var i=t.createElement("data");i.setAttribute("key","edge_relation"),i.innerHTML=e.label,a.appendChild(i)})),(new XMLSerializer).serializeToString(t)}},"8b9b":function(e,t,a){},"9ba3":function(e,t,a){"use strict";a("8b9b")},ad8f:function(e,t,a){"use strict";a.d(t,"n",(function(){return l})),a.d(t,"o",(function(){return d})),a.d(t,"p",(function(){return c})),a.d(t,"m",(function(){return u})),a.d(t,"q",(function(){return p})),a.d(t,"v",(function(){return f})),a.d(t,"i",(function(){return m})),a.d(t,"j",(function(){return b})),a.d(t,"c",(function(){return v})),a.d(t,"k",(function(){return h})),a.d(t,"t",(function(){return g})),a.d(t,"f",(function(){return k})),a.d(t,"d",(function(){return y})),a.d(t,"h",(function(){return A})),a.d(t,"u",(function(){return D})),a.d(t,"b",(function(){return w})),a.d(t,"g",(function(){return x})),a.d(t,"x",(function(){return _})),a.d(t,"y",(function(){return O})),a.d(t,"w",(function(){return C})),a.d(t,"e",(function(){return I})),a.d(t,"r",(function(){return S})),a.d(t,"a",(function(){return j}));var i=a("b775"),r=(a("d3b7"),a("bc3a")),n=a.n(r),s=(a("5c96"),n.a.create({baseURL:"",timeout:5e4}));s.defaults.retry=4,s.defaults.retryDelay=1e5,s.interceptors.response.use((function(e){var t=e.data;return t}),(function(e){return console.log("err"+e),Promise.reject(e)}));var o=s;function l(e){return Object(i["a"])({url:"backend/Projects/searchProject",method:"get",params:e})}function d(e){return Object(i["a"])({url:"backend/Projects/searchVersion",method:"get",params:e})}function c(e){return Object(i["a"])({url:"backend/getResults",method:"get",params:e})}function u(e){return Object(i["a"])({url:"backend/Services/getServices",method:"get",params:e})}function p(e){return Object(i["a"])({url:"backend/Services/insertServices",method:"get",params:e})}function f(e){return Object(i["a"])({url:"backend/Services/updateServices",method:"get",params:e})}function m(e){return Object(i["a"])({url:"backend/Services/deleteServices",method:"get",params:e})}function b(e){return Object(i["a"])({url:"backend/getMap",method:"get",params:e})}function v(e){return Object(i["a"])({url:"backend/addNode",method:"get",params:e})}function h(e){return Object(i["a"])({url:"backend/getNode",method:"get",params:e})}function g(e){return Object(i["a"])({url:"backend/updateNode",method:"get",params:e})}function k(e){return Object(i["a"])({url:"backend/deleteNode",method:"get",params:e})}function y(e){return Object(i["a"])({url:"backend/addRelation",method:"get",params:e})}function A(e){return Object(i["a"])({url:"backend/deleteRelation",method:"get",params:e})}function D(e){return Object(i["a"])({url:"backend/updateRelation",method:"get",params:e})}function w(e){return Object(i["a"])({url:"backend/addLabel",method:"get",params:e})}function x(e){return Object(i["a"])({url:"backend/deleteLabel",method:"get",params:e})}function _(e){return Object(i["a"])({url:"backend/mavenDependency/update",method:"get",params:e})}function O(e){return o({url:"backend/mavenDependency/sshupload",method:"post",headers:{"content-type":"multipart/form-data"},data:e})}function C(e){return o({url:"backend/mavenDependency/uploadFile",method:"post",headers:{"content-type":"multipart/form-data"},data:e})}function I(e){return Object(i["a"])({url:"backend/Projects/insertVersion",method:"get",params:e})}function S(e){return Object(i["a"])({url:"backend/insertSnykData",method:"get",params:e})}function j(e){return Object(i["a"])({url:"backend/crawl",method:"get",params:e})}},b775:function(e,t,a){"use strict";a("d3b7");var i=a("bc3a"),r=a.n(i),n=(a("5c96"),a("4328")),s=a.n(n),o=r.a.create({baseURL:"",timeout:5e4,headers:{"Content-Type":"application/x-www-form-urlencoded"}});o.defaults.retry=4,o.defaults.retryDelay=1e5,o.interceptors.request.use((function(e){return e.data=s.a.stringify(e.data),e}),(function(e){return Promise.error(e)})),o.interceptors.response.use((function(e){var t=e.data;return t}),(function(e){return console.log("err"+e),Promise.reject(e)})),t["a"]=o},bfa9:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"GraphXML数据",visible:e.dialogVisible,width:"50%","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-alert",{attrs:{title:"使用说明",type:"warning",description:"以下数据可以被存储起来，方便下一次流程加载","show-icon":"","close-text":"知道了"}}),a("codemirror",{staticClass:"code",attrs:{value:e.xmlData,options:e.options}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:e.downloadData}},[e._v("下载")])],1)],1)},r=[],n=(a("a7be"),a("d5e0"),a("8f94")),s=a("347e"),o=a.n(s);a("f9d4");var l={props:{data:String},data:function(){return{dialogVisible:!1,xmlData:void 0,options:{mode:"xml",readOnly:!0,lineNumbers:!0}}},components:{codemirror:n["codemirror"]},methods:{init:function(){this.dialogVisible=!0,this.xmlData=o.a.xml(this.data)},downloadData:function(){this.$emit("downloadData")}}},d=l,c=a("2877"),u=Object(c["a"])(d,i,r,!1,null,null,null);t["a"]=u.exports},df4a:function(e,t,a){"use strict";a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return l}));var i=a("b85c"),r=(a("d3b7"),a("159b"),a("c740"),a("fb6a"),a("a434"),a("5892")),n={SERVICE:{color:"64,158,255"},SOFTWARE:{color:"103,194,58"},COMPONENT:{color:"103,194,58"},HOST:{color:"230,162,60"},DOCKER:{color:"230,162,60"},ACCESS:{color:"26,185,211"},INTERFACE:{color:"26,185,211"},NETWORK:{color:"144,147,153"},RISK:{color:"245,108,108"},CUSTOM:{color:"153,153,153"}};function s(e,t){var a={nodes:[],links:[]};return e.forEach((function(e){var t={id:e.id,label:e.label,type:e.type,tags:e.properties.tags,risks:e.properties.risks,version:e.properties.version,serviceId:e.properties.serviceId,serviceNodeId:e.properties.serviceNodeId,riskId:e.properties.riskId,riskNodeId:e.properties.riskNodeId};a.nodes.push(t)})),t.forEach((function(e){a.links.push({source:e.source.id||e.source,target:e.target.id||e.target,label:e.label||"",id:e.id})})),a}function o(e,t){var a,r=Object(i["a"])(e);try{for(r.s();!(a=r.n()).done;){var s=a.value;try{if(s.type=s.type.toUpperCase(),s.color=n[s.type].color,s.properties={risks:s.risks,tags:s.tags||[]},t){if("SOFTWARE"===s.type||"COMPONENT"===s.type){var o=s.properties.tags.findIndex((function(e){return-1!=e.indexOf("Version")}));o>-1&&(s.properties.version=s.properties.tags[o].slice(8),s.properties.tags.splice(o,1))}else if("SERVICE"===s.type){var l=s.properties.tags.findIndex((function(e){return-1!=e.indexOf("ServiceId")}));l>-1&&(s.properties.serviceId=s.properties.tags[l].slice(10),s.properties.tags.splice(l,1)),s.properties.serviceNodeId=s.id}else if("RISK"===s.type){var d=s.properties.tags.findIndex((function(e){return-1!=e.indexOf("RiskId")}));d>-1&&(s.properties.riskId=s.properties.tags[d].slice(7),s.properties.tags.splice(d,1)),s.properties.riskNodeId=s.id}s.properties.tags.shift()}else s.serviceId&&(s.properties.serviceId=s.serviceId),s.serviceNodeId&&(s.properties.serviceNodeId=s.serviceNodeId),s.version&&(s.properties.version=s.version),s.riskId&&(s.properties.riskId=s.riskId),s.riskNodeId&&(s.properties.riskNodeId=s.riskNodeId);delete s.tags,delete s.risks}catch(c){console.error("未定义的节点类型：",s.type,c);continue}}}catch(c){r.e(c)}finally{r.f()}return e}function l(e){return Object(r["a"])(s(o(e.nodes,!0),e.links))}},efaa:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"btn-top"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.createService}},[e._v("注册服务")]),a("div",{staticClass:"text-left-label",staticStyle:{"margin-left":"20px"}},[a("span",[e._v("服务名称：")]),a("el-input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),a("div",{staticClass:"text-left-label",staticStyle:{"margin-left":"20px"}},[a("span",[e._v("维护团队：")]),a("el-input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.teamname,callback:function(t){e.teamname=t},expression:"teamname"}})],1),a("div",{staticClass:"text-left-label",staticStyle:{"margin-left":"20px"}},[a("span",[e._v("服务状态：")]),a("el-select",{staticStyle:{width:"150px"},model:{value:e.isonline,callback:function(t){e.isonline=t},expression:"isonline"}},[a("el-option",{attrs:{label:"任意",value:void 0}}),a("el-option",{attrs:{label:"在线",value:!0}}),a("el-option",{attrs:{label:"离线",value:!1}})],1)],1),a("div",{staticClass:"text-left-label",staticStyle:{"margin-left":"20px"}},[a("el-checkbox",{attrs:{border:"",size:"big"},model:{value:e.CodeUploaded,callback:function(t){e.CodeUploaded=t},expression:"CodeUploaded"}},[e._v("已上传代码")])],1),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",plain:""},on:{click:e.search}},[e._v("查询")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list,"element-loading-text":"Loading"}},[a("el-table-column",{attrs:{label:"序号","min-width":"5%",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.$index+1+(e.currentPage-1)*e.pageSize)+" ")]}}])}),a("el-table-column",{attrs:{label:"服务名称","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" "),t.row.hasFile?a("el-tag",{attrs:{type:"success",size:"mini"}},[e._v("File")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"服务描述","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.desc)+" ")]}}])}),a("el-table-column",{attrs:{label:"服务视图","min-width":"5%",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"btn-link",on:{click:function(a){return e.handleCheckMap(t.$index,t.row)}}},[e._v("服务视图")])]}}])}),a("el-table-column",{attrs:{label:"服务实例","min-width":"5%",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.instance_count)+" ")]}}])}),a("el-table-column",{attrs:{label:"服务状态","min-width":"5%",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.is_online?a("div",[a("el-tag",{attrs:{size:"small"}},[e._v("在线")])],1):a("div",[a("el-tag",{attrs:{type:"info",size:"small"}},[e._v("离线")])],1)]}}])}),a("el-table-column",{attrs:{label:"维护团队","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.teamname)+" ")]}}])}),a("el-table-column",{attrs:{label:"配置文件","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"btn-link",on:{click:function(a){return e.openInfo(t.$index,t.row)}}},[e._v("预览")]),a("a",{staticClass:"btn-link",staticStyle:{"margin-left":"5px"},on:{click:function(a){return e.downloadXml(t.$index,t.row)}}},[e._v("下载")])]}}])}),a("el-table-column",{attrs:{label:"操作",fixed:"right","min-width":"5%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"btn-link",on:{click:function(a){return e.handleModify(t.$index,t.row)}}},[e._v("修改")]),a("a",{staticClass:"btn-link",staticStyle:{"margin-left":"5px"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("el-pagination",{staticClass:"page",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30],"page-size":e.pageSize,layout:" sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.flowInfoVisible?a("flow-info",{ref:"flowInfo",attrs:{data:e.infoData},on:{downloadData:e.downloadData}}):e._e(),a("el-dialog",{attrs:{title:"注册服务",visible:e.dialogAddVisible,width:"600px",center:!0},on:{"update:visible":function(t){e.dialogAddVisible=t},close:function(t){e.serviceAddData={uploadType:"vacant"}}}},[a("el-form",{ref:"registerForm",attrs:{model:e.serviceAddData,"label-width":"100px",rules:e.registerRules}},[a("div",[a("el-form-item",{attrs:{label:"服务名称：",prop:"name"}},[a("el-input",{attrs:{disabled:"vacant"!=e.serviceAddData.uploadType},model:{value:e.serviceAddData.name,callback:function(t){e.$set(e.serviceAddData,"name",t)},expression:"serviceAddData.name"}})],1),a("el-form-item",{attrs:{label:"服务描述：",prop:"desc"}},[a("el-input",{attrs:{disabled:"vacant"!=e.serviceAddData.uploadType,"show-word-limit":"",type:"textarea",maxlength:"200"},model:{value:e.serviceAddData.desc,callback:function(t){e.$set(e.serviceAddData,"desc",t)},expression:"serviceAddData.desc"}})],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"服务实例：",prop:"count"}},[a("el-input",{attrs:{disabled:"vacant"!=e.serviceAddData.uploadType,type:"number",min:0},model:{value:e.serviceAddData.count,callback:function(t){e.$set(e.serviceAddData,"count",e._n(t))},expression:"serviceAddData.count"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"服务状态：",prop:"isonline"}},[a("el-select",{attrs:{clearable:"",disabled:"vacant"!=e.serviceAddData.uploadType},model:{value:e.serviceAddData.isonline,callback:function(t){e.$set(e.serviceAddData,"isonline",t)},expression:"serviceAddData.isonline"}},[a("el-option",{attrs:{label:"在线",value:!0}}),a("el-option",{attrs:{label:"离线",value:!1}})],1)],1)],1)],1),a("el-form-item",{attrs:{label:"维护团队：",prop:"teamname"}},[a("el-input",{attrs:{disabled:"vacant"!=e.serviceAddData.uploadType},model:{value:e.serviceAddData.teamname,callback:function(t){e.$set(e.serviceAddData,"teamname",t)},expression:"serviceAddData.teamname"}})],1)],1),a("el-divider",[e._v("从代码添加")]),a("el-form-item",{attrs:{label:"服务代码：",prop:"uploadType"}},[a("el-col",{attrs:{span:9}},[a("el-form-item",[a("el-select",{on:{change:e.handleUploadTypeChange},model:{value:e.serviceAddData.uploadType,callback:function(t){e.$set(e.serviceAddData,"uploadType",t)},expression:"serviceAddData.uploadType"}},[a("el-option",{attrs:{label:"从git上传",value:"git"}}),a("el-option",{attrs:{label:"从文件上传",value:"file"}}),a("el-option",{attrs:{label:"不上传",value:"vacant"}})],1)],1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"git"===e.serviceAddData.uploadType,expression:"serviceAddData.uploadType === 'git'"}],attrs:{span:14,offset:1}},[a("el-form-item",{attrs:{prop:"git"}},[a("el-input",{attrs:{placeholder:"Git仓库地址"},model:{value:e.serviceAddData.git,callback:function(t){e.$set(e.serviceAddData,"git",t)},expression:"serviceAddData.git"}})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"http"===e.urlType,expression:"urlType === 'http'"}]},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"用户名：",prop:"username"}},[a("el-input",{model:{value:e.serviceAddData.username,callback:function(t){e.$set(e.serviceAddData,"username",t)},expression:"serviceAddData.username"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"密码：",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.serviceAddData.password,callback:function(t){e.$set(e.serviceAddData,"password",t)},expression:"serviceAddData.password"}})],1)],1)],1),a("el-form-item",[a("el-upload",{directives:[{name:"show",rawName:"v-show",value:"file"===e.serviceAddData.uploadType||"ssh"===e.urlType,expression:"serviceAddData.uploadType === 'file' || urlType === 'ssh'"}],ref:"upload",staticClass:"upload-demo",attrs:{action:"fake","on-error":e.handleFileUploadError,"on-success":e.handleFileUploadSuccess,"file-list":e.fileList,"auto-upload":!1,multiple:!1,limit:1,"on-exceed":e.handleFileExceed,"http-request":e.handleUploadFile,drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或"),a("em",[e._v("点击上传")]),a("br"),e.urlType?a("span",[e._v("请上传ssh私钥文件")]):a("span",[e._v("只能上传一个zip/rar(rar4版本)文件")])])])],1),a("div",{staticClass:"form-buttons"},[a("el-button",{staticClass:"input-top",attrs:{type:"primary"},on:{click:e.submitAdd}},[e._v("提交")]),a("el-button",{on:{click:function(t){return e.$refs.registerForm.resetFields()}}},[e._v("重置")])],1)],1)],1),a("el-dialog",{attrs:{title:"修改服务",visible:e.dialogModifyVisible,width:"600px",center:!0},on:{"update:visible":function(t){e.dialogModifyVisible=t}}},[a("el-form",{ref:"modifyForm",attrs:{model:e.serviceModifyData,"label-width":"100px",rules:e.manualRegisterRules}},[a("el-form-item",{attrs:{label:"服务名称："}},[a("el-input",{attrs:{disabled:""},model:{value:e.serviceModifyData.name,callback:function(t){e.$set(e.serviceModifyData,"name",t)},expression:"serviceModifyData.name"}})],1),a("el-form-item",{attrs:{label:"服务描述：",prop:"desc"}},[a("el-input",{attrs:{"show-word-limit":"",type:"textarea",maxlength:"200"},model:{value:e.serviceModifyData.desc,callback:function(t){e.$set(e.serviceModifyData,"desc",t)},expression:"serviceModifyData.desc"}})],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{inline:"",label:"服务实例：",prop:"count"}},[a("el-input",{attrs:{type:"number",min:0},model:{value:e.serviceModifyData.count,callback:function(t){e.$set(e.serviceModifyData,"count",e._n(t))},expression:"serviceModifyData.count"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{inline:"",label:"服务状态：",prop:"isonline"}},[a("el-select",{attrs:{clearable:""},model:{value:e.serviceModifyData.isonline,callback:function(t){e.$set(e.serviceModifyData,"isonline",t)},expression:"serviceModifyData.isonline"}},[a("el-option",{attrs:{label:"在线",value:!0}}),a("el-option",{attrs:{label:"离线",value:!1}})],1)],1)],1)],1),a("el-form-item",{attrs:{inline:"",label:"维护团队：",prop:"teamname"}},[a("el-input",{model:{value:e.serviceModifyData.teamname,callback:function(t){e.$set(e.serviceModifyData,"teamname",t)},expression:"serviceModifyData.teamname"}})],1),a("div",{staticClass:"form-buttons"},[a("el-button",{staticClass:"input-top",attrs:{type:"primary"},on:{click:e.submitModify}},[e._v("提交")]),a("el-button",{on:{click:function(t){return e.$refs.modifyForm.resetFields()}}},[e._v("重置")])],1)],1)],1)],1)},r=[],n=a("c7eb"),s=a("1da1"),o=(a("ac1f"),a("00b4"),a("b0c0"),a("caad"),a("2532"),a("4de4"),a("d3b7"),a("159b"),a("a434"),a("ad8f")),l=a("bfa9"),d=a("61f7"),c=a("df4a"),u={name:"service",components:{FlowInfo:l["a"]},data:function(){var e=this,t=function(e,t,a){Object(o["m"])({name:t}).then((function(e){e.totalCount>0?a(new Error("该服务已存在！")):a()})).catch((function(e){console.error(e),a(new Error("查询服务出错！"))}))},a=function(t,a,i){if("git"===e.serviceAddData.uploadType)if(a&&""!==a){var r=/^(http:\/\/|git@|https:\/\/).*\.git$/;r.test(a)||i(new Error("请输入正确的git地址"))}else i(new Error("请输入地址"));i()};return{currentPage:1,pageSize:20,total:0,list:null,listLoading:!0,dialogAddVisible:!1,dialogModifyVisible:!1,flowInfoVisible:!1,infoData:"",fileList:[],serviceAddData:{name:"",desc:"",isonline:void 0,teamname:"",count:0,git:"",uploadType:"vacant",file:[]},serviceModifyData:{id:void 0,name:"",desc:"",isonline:void 0,teamname:"",count:0,changeonline:!0},name:"",teamname:"",isonline:void 0,CodeUploaded:!1,serviceOptions:[],manualRegisterRules:{name:[{required:!0,message:"请输入服务名",trigger:"blur"},{validator:d["b"],trigger:"blur"},{validator:t,trigger:"blur"}],count:[{required:!0,message:"请输入实例数",trigger:"blur"}],desc:[{required:!0,message:"请输入服务描述",trigger:"blur"}],teamname:[{required:!0,message:"请输入维护团队",trigger:"blur"}],isonline:[{required:!0,message:"请选择服务状态",trigger:"blur"}],uploadType:[{required:!0,message:"请选择代码",trigger:"blur"}]},gitRegisterRules:{git:[{required:!0,message:"请输入正确的git地址",trigger:"blur"},{validator:a,trigger:"blur"}]},registerRules:{}}},computed:{urlType:function(){return this.serviceAddData.git&&0==this.serviceAddData.git.indexOf("http")?"http":!(!this.serviceAddData.git||0!=this.serviceAddData.git.indexOf("git@"))&&"ssh"}},created:function(){this.registerRules=this.manualRegisterRules,this.fetchData()},methods:{createService:function(){this.dialogAddVisible=!0},handleModify:function(e,t){this.dialogModifyVisible=!0,this.serviceModifyData.name=t.name,this.serviceModifyData.desc=t.desc,this.serviceModifyData.isonline=t.is_online,this.serviceModifyData.teamname=t.teamname,this.serviceModifyData.count=t.instance_count,this.serviceModifyData.id=t.id},handleDelete:function(e,t){this.submitDelete(t)},handleCheckMap:function(e,t){this.$router.push({path:"/workspace/rootName/"+t.name,query:{serviceId:t.id}})},handleFileUploadError:function(e,t,a){this.$message.error("解析失败！错误:".concat(e))},handleFileUploadSuccess:function(e,t,a){console.log(e),this.$message.success("上传成功！"),this.dialogAddVisible=!1,this.fetchData()},handleFileExceed:function(e,t){this.fileList=[e[0]]},handleUploadTypeChange:function(e){"vacant"==e?this.registerRules=this.manualRegisterRules:"git"===e?(this.$refs.registerForm.resetFields(),this.registerRules=this.gitRegisterRules,this.serviceAddData={uploadType:"git"}):(this.$refs.registerForm.resetFields(),this.registerRules=null,this.serviceAddData={uploadType:"file"}),this.$refs.registerForm.clearValidate(["name","desc","count","teamname","isonline","git"]),this.fileList=[]},submitAdd:function(){var e=Object(s["a"])(Object(n["a"])().mark((function e(){var t=this;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.registerForm.validate((function(e){e&&("git"===t.serviceAddData.uploadType&&"http"==t.urlType?Object(o["x"])({gitPath:t.serviceAddData.git,username:t.serviceAddData.username||"",password:t.serviceAddData.password||""}).then((function(e){t.$nextTick((function(){loadingInstance.close()})),"Succeed"===e.result?(t.$message.success("上传成功！"),t.serviceAddData.parentService&&(t.dialogAddVisible=!1),t.fetchData()):"Failed"===e.result&&t.$message.error("解析失败！错误:".concat(e.exception))})).catch((function(e){t.$nextTick((function(){loadingInstance.close()})),e.message.includes("timeout")?(t.$message.info("上传请求已发送！请刷新"),t.dialogAddVisible=!1):t.$message.error("上传失败！错误:".concat(e))})):"vacant"===t.serviceAddData.uploadType?Object(o["q"])(t.serviceAddData).then((function(e){"Succeed"===e.result&&Object(o["c"])({label:"SERVICE",name:t.serviceAddData.name}).then((function(a){"Succeed"===a.result?Object(o["b"])({id:a.id,label:"ServiceId="+e.id}).then((function(e){"Succeed"===e.result?(t.dialogAddVisible=!1,t.fetchData()):t.$message({message:"ServiceId添加出错",type:"warning"})})):t.$message({message:"节点添加出错",type:"error"})}))})):t.$refs.upload.submit())}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submitModify:function(){var e=this;this.$refs.modifyForm.validate((function(t){t&&Object(o["v"])(e.serviceModifyData).then((function(t){"Succeed"===t.result&&(e.dialogModifyVisible=!1,e.fetchData())}))}))},submitDelete:function(e){var t=this;this.$confirm("此操作将会删除数据库中该服务和其所有关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["k"])({label:"ServiceId="+e.id}).then((function(a){a.node.length>0?Object(o["f"])({id:a.node[0].id,isHard:!0}).then((function(a){"Succeed"===a.result?Object(o["i"])({id:e.id}).then((function(e){"Succeed"===e.result?t.fetchData():t.$message.error("服务删除失败")})):t.$message.error("节点删除失败")})):Object(o["i"])({id:e.id}).then((function(e){"Succeed"===e.result?t.fetchData():t.$message.error("服务删除失败")}))}))})).catch((function(){}))},search:function(){this.currentPage=1,this.fetchData()},clearText:function(){this.fetchData()},handleSizeChange:function(e){this.pageSize=e,this.currentPage=1,this.fetchData()},handleCurrentChange:function(e){this.currentPage=e,this.fetchData()},remoteServiceSearch:function(e){var t=this;""!==e?Object(o["k"])({label:"SERVICE"}).then((function(a){console.log(a),t.serviceOptions=a.node.filter((function(t){return t.label.includes(e)}))})):this.serviceOptions=[]},fetchCodeUploadedData:function(){var e=this;return Object(s["a"])(Object(n["a"])().mark((function t(){var a,i,r,s,l;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.listLoading=!0,a={keyword:e.name,searchOnline:void 0!=e.isonline,isonline:e.isonline,teamname:e.teamname,desc:!0},t.next=4,Object(o["k"])({label:"CodeUploaded"});case 4:return i=t.sent,r=[],t.next=8,Object(o["m"])(a);case 8:s=t.sent,l=[],r=s.services,r.forEach((function(e){var t=i.node.some((function(t,a,i){return t.label===e.name}));e.hasFile=!!t,t&&l.push(e)})),e.total=l.length,e.list=l.splice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),e.listLoading=!1;case 15:case"end":return t.stop()}}),t)})))()},fetchData:function(){var e=this;return Object(s["a"])(Object(n["a"])().mark((function t(){var a,i,r;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.CodeUploaded){t.next=3;break}return e.fetchCodeUploadedData(),t.abrupt("return");case 3:return e.listLoading=!0,a={page:e.currentPage,rowPerPage:e.pageSize,keyword:e.name,searchOnline:void 0!=e.isonline,isonline:e.isonline,teamname:e.teamname,desc:!0},t.next=7,Object(o["k"])({label:"CodeUploaded"});case 7:i=t.sent,r=[],Object(o["m"])(a).then((function(t){r=t.services,r.forEach((function(e){var t=i.node.some((function(t,a,i){return t.label===e.name}));e.hasFile=!!t})),e.list=r,e.total=t.totalCount,e.listLoading=!1}));case 10:case"end":return t.stop()}}),t)})))()},modelClose:function(){this.$emit("close")},openInfo:function(e,t){var a=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var i;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.flowInfoVisible=!0,e.next=3,Object(o["j"])({rootName:t.name});case 3:i=e.sent,0!=i.nodes.length&&(a.infoData=Object(c["b"])(i),a.$nextTick((function(){this.$refs.flowInfo.init()})));case 5:case"end":return e.stop()}}),e)})))()},downloadXml:function(e,t){var a=this;return Object(s["a"])(Object(n["a"])().mark((function e(){var i,r,s,l;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["j"])({rootName:t.name});case 2:i=e.sent,0!=i.nodes.length?(r=Object(c["b"])(i),s="data:text/xml;charset=utf-8,"+encodeURIComponent(r),l=document.createElement("a"),l.setAttribute("href",s),l.setAttribute("download","data.xml"),l.click(),l.remove(),a.$message.success("正在下载中,请稍后...")):a.$message.error("数据请求错误");case 4:case"end":return e.stop()}}),e)})))()},downloadData:function(){var e="data:text/xml;charset=utf-8,"+encodeURIComponent(this.infoData),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","data.xml"),t.click(),t.remove(),this.$message.success("正在下载中,请稍后...")},handleUploadFile:function(e){var t=this,a=e.file,i=a.type;if(this.urlType){var r=new FormData;r.append("file",a),r.append("gitPath",this.serviceAddData.git);var n=this.$loading({text:"正在上传代码"});Object(o["y"])(r).then((function(e){t.$nextTick((function(){n.close()})),"Succeed"===e.result?(t.$message.success("上传成功！"),t.dialogAddVisible=!1,t.fetchData()):"Failed"===e.result&&t.$message.error("解析失败！错误:".concat(e.exception))})).catch((function(e){t.$nextTick((function(){n.close()})),e.message.includes("timeout")?(t.$message.info("上传请求已发送！请刷新"),t.dialogAddVisible=!1):t.$message.error("上传失败！错误:".concat(e))}))}else{if(-1==i.indexOf("zip")&&-1==i.indexOf("rar"))return void this.$message.error("只能上传rar zip格式");var s=new FormData;s.append("file",e.file);var l=this.$loading({text:"正在上传代码"});Object(o["w"])(s).then((function(e){t.$nextTick((function(){l.close()})),"Succeed"===e.result?(t.$message.success("上传成功！"),t.dialogAddVisible=!1,t.fetchData()):"Failed"===e.result&&t.$message.error("解析失败！错误:".concat(e.exception))})).catch((function(e){t.$nextTick((function(){l.close()})),e.message.includes("timeout")?(t.$message.info("上传请求已发送！请刷新"),t.dialogAddVisible=!1):t.$message.error("上传失败！错误:".concat(e))}))}}}},p=u,f=(a("9ba3"),a("2877")),m=Object(f["a"])(p,i,r,!1,null,null,null);t["default"]=m.exports}}]);